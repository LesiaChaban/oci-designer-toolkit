version: 0.1
component: build
timeoutInSeconds: 1000
shell: bash

steps:
  - type: Command
    name: "Install Node.js and update NPM to >=9.0.0"
    command: |
      node --version
      npm install -g npm@9
      npm --version
  - type: Command
    name: "Install dependencies & cyclonedx-node-npm package"
    command: |
      npm install && npm install --save-dev @cyclonedx/cyclonedx-npm@1.19.3
  - type: Command
    name: "Run cyclonedx-node-npm package"
    command: |
      # For more details, visit https://github.com/CycloneDX/cyclonedx-node-npm/blob/main/README.md
      npx @cyclonedx/cyclonedx-npm --omit dev --output-format JSON --output-file artifactSBOM.json --spec-version 1.4 --flatten-components

outputArtifacts:
  - name: artifactSBOM
    type: BINARY
    location: ${OCI_PRIMARY_SOURCE_DIR}/artifactSBOM.json
